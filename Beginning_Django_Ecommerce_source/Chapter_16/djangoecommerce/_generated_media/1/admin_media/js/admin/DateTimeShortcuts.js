var DateTimeShortcuts={calendars:[],calendarInputs:[],clockInputs:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",admin_media_prefix:"",init:function(){var b=document.getElementsByTagName("script");for(var c=0;c<b.length;c++){if(b[c].src.match(/DateTimeShortcuts/)){var a=b[c].src.indexOf("js/admin/DateTimeShortcuts");DateTimeShortcuts.admin_media_prefix=b[c].src.substring(0,a);break}}var e=document.getElementsByTagName("input");for(c=0;c<e.length;c++){var d=e[c];if(d.getAttribute("type")=="text"&&d.className.match(/vTimeField/)){DateTimeShortcuts.addClock(d)}else{if(d.getAttribute("type")=="text"&&d.className.match(/vDateField/)){DateTimeShortcuts.addCalendar(d)}}}},addClock:function(e){var c=DateTimeShortcuts.clockInputs.length;DateTimeShortcuts.clockInputs[c]=e;var a=document.createElement("span");e.parentNode.insertBefore(a,e.nextSibling);var d=document.createElement("a");d.setAttribute("href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", new Date().getHourMinuteSecond());");d.appendChild(document.createTextNode(gettext("Now")));var b=document.createElement("a");b.setAttribute("href","javascript:DateTimeShortcuts.openClock("+c+");");b.id=DateTimeShortcuts.clockLinkName+c;quickElement("img",b,"","src",DateTimeShortcuts.admin_media_prefix+"img/admin/icon_clock.gif","alt",gettext("Clock"));a.appendChild(document.createTextNode("\240"));a.appendChild(d);a.appendChild(document.createTextNode("\240|\240"));a.appendChild(b);var f=document.createElement("div");f.style.display="none";f.style.position="absolute";f.className="clockbox module";f.setAttribute("id",DateTimeShortcuts.clockDivName+c);document.body.appendChild(f);addEvent(f,"click",DateTimeShortcuts.cancelEventPropagation);quickElement("h2",f,gettext("Choose a time"));time_list=quickElement("ul",f,"");time_list.className="timelist";quickElement("a",quickElement("li",time_list,""),gettext("Now"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", new Date().getHourMinuteSecond());");quickElement("a",quickElement("li",time_list,""),gettext("Midnight"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", '00:00:00');");quickElement("a",quickElement("li",time_list,""),gettext("6 a.m."),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", '06:00:00');");quickElement("a",quickElement("li",time_list,""),gettext("Noon"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", '12:00:00');");cancel_p=quickElement("p",f,"");cancel_p.className="calendar-cancel";quickElement("a",cancel_p,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissClock("+c+");")},openClock:function(b){var c=document.getElementById(DateTimeShortcuts.clockDivName+b);var a=document.getElementById(DateTimeShortcuts.clockLinkName+b);if(getStyle(document.body,"direction")!="rtl"){c.style.left=findPosX(a)+17+"px"}else{c.style.left=findPosX(a)-110+"px"}c.style.top=findPosY(a)-30+"px";c.style.display="block";addEvent(window,"click",function(){DateTimeShortcuts.dismissClock(b);return true})},dismissClock:function(a){document.getElementById(DateTimeShortcuts.clockDivName+a).style.display="none";window.onclick=null},handleClockQuicklink:function(a,b){DateTimeShortcuts.clockInputs[a].value=b;DateTimeShortcuts.dismissClock(a)},addCalendar:function(g){var d=DateTimeShortcuts.calendars.length;DateTimeShortcuts.calendarInputs[d]=g;var f=document.createElement("span");g.parentNode.insertBefore(f,g.nextSibling);var k=document.createElement("a");k.setAttribute("href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");k.appendChild(document.createTextNode(gettext("Today")));var b=document.createElement("a");b.setAttribute("href","javascript:DateTimeShortcuts.openCalendar("+d+");");b.id=DateTimeShortcuts.calendarLinkName+d;quickElement("img",b,"","src",DateTimeShortcuts.admin_media_prefix+"img/admin/icon_calendar.gif","alt",gettext("Calendar"));f.appendChild(document.createTextNode("\240"));f.appendChild(k);f.appendChild(document.createTextNode("\240|\240"));f.appendChild(b);var j=document.createElement("div");j.style.display="none";j.style.position="absolute";j.className="calendarbox module";j.setAttribute("id",DateTimeShortcuts.calendarDivName1+d);document.body.appendChild(j);addEvent(j,"click",DateTimeShortcuts.cancelEventPropagation);var c=quickElement("div",j,"");var l=quickElement("a",c,"<","href","javascript:DateTimeShortcuts.drawPrev("+d+");");l.className="calendarnav-previous";var i=quickElement("a",c,">","href","javascript:DateTimeShortcuts.drawNext("+d+");");i.className="calendarnav-next";var h=quickElement("div",j,"","id",DateTimeShortcuts.calendarDivName2+d);h.className="calendar";DateTimeShortcuts.calendars[d]=new Calendar(DateTimeShortcuts.calendarDivName2+d,DateTimeShortcuts.handleCalendarCallback(d));DateTimeShortcuts.calendars[d].drawCurrent();var a=quickElement("div",j,"");a.className="calendar-shortcuts";quickElement("a",a,gettext("Yesterday"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", -1);");a.appendChild(document.createTextNode("\240|\240"));quickElement("a",a,gettext("Today"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");a.appendChild(document.createTextNode("\240|\240"));quickElement("a",a,gettext("Tomorrow"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", +1);");var e=quickElement("p",j,"");e.className="calendar-cancel";quickElement("a",e,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissCalendar("+d+");")},openCalendar:function(a){var b=document.getElementById(DateTimeShortcuts.calendarDivName1+a);var d=document.getElementById(DateTimeShortcuts.calendarLinkName+a);var e=DateTimeShortcuts.calendarInputs[a];if(e.value){var f=e.value.split("-");var c=f[0];var g=parseFloat(f[1]);if(c.match(/\d\d\d\d/)&&g>=1&&g<=12){DateTimeShortcuts.calendars[a].drawDate(g,c)}}if(getStyle(document.body,"direction")!="rtl"){b.style.left=findPosX(d)+17+"px"}else{b.style.left=findPosX(d)-180+"px"}b.style.top=findPosY(d)-75+"px";b.style.display="block";addEvent(window,"click",function(){DateTimeShortcuts.dismissCalendar(a);return true})},dismissCalendar:function(a){document.getElementById(DateTimeShortcuts.calendarDivName1+a).style.display="none"},drawPrev:function(a){DateTimeShortcuts.calendars[a].drawPreviousMonth()},drawNext:function(a){DateTimeShortcuts.calendars[a].drawNextMonth()},handleCalendarCallback:function(a){return"function(y, m, d) { DateTimeShortcuts.calendarInputs["+a+"].value = y+'-'+(m<10?'0':'')+m+'-'+(d<10?'0':'')+d; document.getElementById(DateTimeShortcuts.calendarDivName1+"+a+").style.display='none';}"},handleCalendarQuickLink:function(a,c){var b=new Date();b.setDate(b.getDate()+c);DateTimeShortcuts.calendarInputs[a].value=b.getISODate();DateTimeShortcuts.dismissCalendar(a)},cancelEventPropagation:function(a){if(!a){a=window.event}a.cancelBubble=true;if(a.stopPropagation){a.stopPropagation()}}};addEvent(window,"load",DateTimeShortcuts.init);